/*!
 * @version 1.0.5
 * @date 2018-07-31
 */
!function(e){var n={};function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="./",t(t.s=0)}([function(e,n,t){t(1),e.exports=t(4)},function(e,n,t){"use strict";"undefined"===typeof Promise&&(window.Promise=t(2)),Object.assign=t(3)},function(e,n){!function(n){var t=setTimeout;function r(){}function o(e){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!==typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(e,this)}function i(e,n){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,o._immediateFn(function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null!==t){var r;try{r=t(e._value)}catch(e){return void s(n.promise,e)}a(n.promise,r)}else(1===e._state?a:s)(n.promise,e._value)})):e._deferreds.push(n)}function a(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"===typeof n||"function"===typeof n)){var t=n.then;if(n instanceof o)return e._state=3,e._value=n,void u(e);if("function"===typeof t)return void c((r=t,i=n,function(){r.apply(i,arguments)}),e)}e._state=1,e._value=n,u(e)}catch(n){s(e,n)}var r,i}function s(e,n){e._state=2,e._value=n,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var n=0,t=e._deferreds.length;n<t;n++)i(e,e._deferreds[n]);e._deferreds=null}function c(e,n){var t=!1;try{e(function(e){t||(t=!0,a(n,e))},function(e){t||(t=!0,s(n,e))})}catch(e){if(t)return;t=!0,s(n,e)}}o.prototype.catch=function(e){return this.then(null,e)},o.prototype.then=function(e,n){var t=new this.constructor(r);return i(this,new function(e,n,t){this.onFulfilled="function"===typeof e?e:null,this.onRejected="function"===typeof n?n:null,this.promise=t}(e,n,t)),t},o.all=function(e){return new o(function(n,t){if(!e||"undefined"===typeof e.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(e);if(0===r.length)return n([]);var o=r.length;function i(e,a){try{if(a&&("object"===typeof a||"function"===typeof a)){var s=a.then;if("function"===typeof s)return void s.call(a,function(n){i(e,n)},t)}r[e]=a,0===--o&&n(r)}catch(e){t(e)}}for(var a=0;a<r.length;a++)i(a,r[a])})},o.resolve=function(e){return e&&"object"===typeof e&&e.constructor===o?e:new o(function(n){n(e)})},o.reject=function(e){return new o(function(n,t){t(e)})},o.race=function(e){return new o(function(n,t){for(var r=0,o=e.length;r<o;r++)e[r].then(n,t)})},o._immediateFn="function"===typeof setImmediate&&function(e){setImmediate(e)}||function(e){t(e,0)},o._unhandledRejectionFn=function(e){"undefined"!==typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},o._setImmediateFn=function(e){o._immediateFn=e},o._setUnhandledRejectionFn=function(e){o._unhandledRejectionFn=e},"undefined"!==typeof e&&e.exports?e.exports=o:n.Promise||(n.Promise=o)}(this)},function(e,n,t){"use strict";var r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var n={},t=0;t<10;t++)n["_"+String.fromCharCode(t)]=t;if("0123456789"!==Object.getOwnPropertyNames(n).map(function(e){return n[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,n){for(var t,a,s=function(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),u=1;u<arguments.length;u++){for(var c in t=Object(arguments[u]))o.call(t,c)&&(s[c]=t[c]);if(r){a=r(t);for(var f=0;f<a.length;f++)i.call(t,a[f])&&(s[a[f]]=t[a[f]])}}return s}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){}return e.generate=function(){var n=e._getRandomInt,t=e._hexAligner;return t(n(32),8)+"-"+t(n(16),4)+"-"+t(16384|n(12),4)+"-"+t(32768|n(14),4)+"-"+t(n(48),12)},e._getRandomInt=function(e){return e<0?NaN:e<=30?0|Math.random()*(1<<e):e<=53?(0|Math.random()*(1<<30))+(0|Math.random()*(1<<e-30))*(1<<30):NaN},e._getIntAligner=function(e){return function(n,t){for(var r=n.toString(e),o=t-r.length,i="0";o>0;o>>>=1,i+=i)1&o&&(r=i+r);return r}},e._hexAligner=e._getIntAligner(16),e.prototype.toString=function(){return this.hexString},e}(),o={isPromise:function(e){return e&&"function"===typeof e.then},isArray:function(e){return"[object Array]"==Object.prototype.toString.call(e)},isObject:function(e){return"[object Object]"!==Object.prototype.toString.call(e)},id2Arr:function(e){if([].push(e),"[object Array]"==Object.prototype.toString.call(e))return e},serializeFunction:function(e){return!(!e||"function"!==typeof e)&&encodeURI(e.toString())},deSerializeFunction:function(e){return!(!e||"string"!==typeof e)&&decodeURI(e)},serializeError:function(e){var n=void 0,t={},r=["name","message","stack","custom"];if(e instanceof Error){for(n=r.length-1;n>=0;n--)t[r[n]]=e[r[n]];return t}return t},deSerializeError:function(e){var n=void 0,t=new Error("");if(!e)return t;var r=Object.keys(e);for(n=0;n<r.length;n++)t[r[n]]=e[r[n]];return t},stringifyJson:function(e,n){try{e=JSON.stringify(e)}catch(e){console.warn(n)}return e},parseJson:function(e,n){var t=void 0;try{t=JSON.parse(e)}catch(e){console.warn(n)}return t}},i=function(){var e={};return e.promise=new Promise(function(n,t){e.resolve=n,e.reject=t}),e},a={config:{maxWorkers:window.navigator&&window.navigator.hardwareConcurrency||3,minWorkers:1},queue:[],allTasks:{},excuTask:[],changeMaxWorkers:function(e){a.config.maxWorkers=e},addTask:function(e){if(e){var n=e.id;a.allTasks[n]=e,a.queue.push(n),setTimeout(function(){a.updateQueue()},0)}},removeTask:function(e){if(e&&a.allTasks[e]){var n=a.queue.indexOf(e);n>-1&&a.queue.splice(n,1),a.allTasks[e].removeListeners(),a.allTasks[e]=null,delete a.allTasks[e]}},getTask:function(e){var n={},t=e?o.id2Arr(e):Object.keys(a.allTasks);return"string"==typeof e||a.allTasks[e]?a.allTasks[e]:(t&&t.forEach(function(e){a.allTasks[e]&&(n[e]=a.allTasks[e])}),n)},getIdleWorker:function(e){var n={},t=e?o.id2Arr(e):Object.keys(a.allTasks);return"string"==typeof e||a.allTasks[e]?a.allTasks[e]:(t&&t.forEach(function(e){a.allTasks[e]&&!a.allTasks[e].busy&&(n[e]=a.allTasks[e])}),n)},getNextTask:function(e){if(a.queue.length)return e=e||a.queue.shift(),!(!a.allTasks[e]||a.allTasks[e].busy||!a.allTasks[e].excuMethods)?e:a.getNextTask()},updateQueue:function(){if(!(a.excuTask>=a.config.maxWorkers))for(;a.excuTask.length<a.config.maxWorkers;){var e=a.getNextTask();if(!e||a.allTasks[e].busy)break;var n=a.allTasks[e].excuMethods._fn,t=a.allTasks[e].excuMethods._args;a.excuTask.push(e),a.allTasks[e].excu(n,t)}},completeTask:function(e){if(e){var n=a.excuTask.indexOf(e);a.excuTask.splice(n,1),a.updateQueue()}}},s=a,u=t(5),c=t.n(u),f=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();var l=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=n.id?n.id:r.generate(),this.worker=new c.a,this.busy=!1,this.reslover=new i,this.onMessage=this.onMessage.bind(this),this.onError=this.onError.bind(this),this.addListeners(),s.addTask(this)}return f(e,[{key:"excu",value:function(e,n){if(this.busy)throw new Error("id:"+this.id+" worker is busy");var t,r;return e&&"function"===typeof e&&(t=o.serializeFunction(e),r=o.stringifyJson(n)),this.worker.postMessage({_fn:t,_args:r}),this.busy=!0,this.reslover.promise}},{key:"onMessage",value:function(e){var n=o.parseJson(e.data);return this.busy=!1,s.completeTask(this.id),this.reslover.resolve(n)}},{key:"onError",value:function(e){var n=o.parseJson(e.data);this.busy=!1,this.reslover.promise.catch(n)}},{key:"addListeners",value:function(){this.worker.addEventListener("message",this.onMessage),this.worker.addEventListener("error",this.onError)}},{key:"removeListeners",value:function(){this.worker.removeEventListener("message",this.onMessage),this.worker.removeEventListener("error",this.onError)}}]),e}(),d=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();var h=new(function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),n.maxWorkers&&s.changeMaxWorkers(n.maxWorkers)}return d(e,[{key:"add",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new l(e)}},{key:"race",value:function(e){for(var n=[],t=[],r=0;r<e.length;r++){var o=this.add();n.push(o),t.push(o.reslover.promise)}return n.map(function(n,t){n.excu(e[t].fn,e[t].args)}),Promise.race(t)}},{key:"all",value:function(e){for(var n=[],t=[],r=0;r<e.length;r++){var o=this.add();n.push(o),t.push(o.reslover.promise)}return n.map(function(n,t){n.excu(e[t].fn,e[t].args)}),Promise.all(t)}},{key:"getWorker",value:function(e){return s.getTask(e)}},{key:"getIdleWorker",value:function(e){return s.getIdleWorker(e)}},{key:"removeWorker",value:function(e){return s.removeTask(e)}}]),e}())({maxWorkers:1});function p(e){return 1==e||2==e?1:p(e-1)+p(e-2)}h.add({id:1}),h.add({id:10}).excu(p,[10]).then(function(e){console.log("\u521b\u5efa\u6307\u5b9aid worker\uff0c\u8ba1\u7b97"),console.log(e),document.write("Fibonacci(10):"+e+"<br>")}),h.add().excu(p,20).then(function(e){console.log("\u521b\u5efa worker\uff0c\u8ba1\u7b97 \uff08\u81ea\u52a8\u5206\u914did\uff09"),console.log(e),document.write("Fibonacci(20):"+e+"<br>")}),h.getWorker(1).excu(p,30).then(function(e){console.log("\u67e5\u627eid\u4e3a10\u7684worker"),console.log(e),document.write("Fibonacci(30):"+e+"<br>")}),h.race([{fn:p,args:30},{fn:p,args:10}]).then(function(e){console.log("race\u65b9\u6cd5",e),document.write("<mark>race</mark> : Fibonacci(30),Fibonacci(10):<mark>"+e+"</mark><br>")}),h.all([{fn:p,args:20},{fn:p,args:10}]).then(function(e){console.log("all\u65b9\u6cd5",e),document.write("<mark>all</mark> : Fibonacci(20),Fibonacci(10):<mark>"+e+"</mark><br>")}).then(function(){document.write("2s\u540e\u9500\u6bc1\u5168\u90e8worker<br>")}).then(function(){setTimeout(function(){document.write("\u5168\u90e8worker\u5df2\u9500\u6bc1")},2e3)})},function(e,n,t){e.exports=function(){return new Worker(t.p+"cfe6044893385a4d23fc.worker.js")}}]);