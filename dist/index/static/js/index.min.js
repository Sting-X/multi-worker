/*!
 * @version 1.0.3
 * @date 2018-07-12
 */
!function(e){var n={};function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="./",t(t.s=1)}([function(e,n,t){"use strict";function r(e,n){var t=this;if(!(this instanceof r))throw new SyntaxError("Constructor must be called with the new operator");if("function"!==typeof e)throw new SyntaxError("Function parameter handler(resolve, reject) missing");var s=[],u=[];this.resolved=!1,this.rejected=!1,this.pending=!0;var c=function(e,n){s.push(e),u.push(n)};this.then=function(e,n){return new r(function(t,r){var i=e?o(e,t,r):t,a=n?o(n,t,r):r;c(i,a)},t)};var f=function(e){return t.resolved=!0,t.rejected=!1,t.pending=!1,s.forEach(function(n){n(e)}),c=function(n,t){n(e)},f=l=function(){throw new Error("Promise is already resolved")},t},l=function(e){return t.resolved=!1,t.rejected=!0,t.pending=!1,u.forEach(function(n){n(e)}),c=function(n,t){t(e)},f=l=function(){throw new Error("Promise is already resolved")},t};this.cancel=function(){return n?n.cancel():l(new i),t},this.timeout=function(e){if(n)n.timeout(e);else{var r=setTimeout(function(){l(new a("Promise timed out after "+e+" ms"))},e);t.always(function(){clearTimeout(r)})}return t},e(function(e){f(e)},function(e){l(e)})}function o(e,n,t){return function(r){try{var o=e(r);o&&"function"===typeof o.then&&"function"===typeof o.catch?o.then(n,t):n(o)}catch(e){t(e)}}}function i(e){this.message=e||"promise cancelled",this.stack=(new Error).stack}function a(e){this.message=e||"timeout exceeded",this.stack=(new Error).stack}r.prototype.catch=function(e){return this.then(null,e)},r.prototype.always=function(e){return this.then(e,e)},r.all=function(e){return new r(function(n,t){var r=e.length,o=[];r?e.forEach(function(e,i){e.then(function(e){o[i]=e,0==--r&&n(o)},function(e){r=0,t(e)})}):n(o)})},r.defer=function(){var e={};return e.promise=new r(function(n,t){e.resolve=n,e.reject=t}),e},i.prototype=new Error,i.prototype.constructor=Error,i.prototype.name="CancellationError",r.CancellationError=i,a.prototype=new Error,a.prototype.constructor=Error,a.prototype.name="TimeoutError",r.TimeoutError=a,e.exports=r},function(e,n,t){t(2),e.exports=t(5)},function(e,n,t){"use strict";"undefined"===typeof Promise&&(window.Promise=t(3)),Object.assign=t(4)},function(e,n){!function(n){var t=setTimeout;function r(){}function o(e){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!==typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(e,this)}function i(e,n){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,o._immediateFn(function(){var t=1===e._state?n.onFulfilled:n.onRejected;if(null!==t){var r;try{r=t(e._value)}catch(e){return void s(n.promise,e)}a(n.promise,r)}else(1===e._state?a:s)(n.promise,e._value)})):e._deferreds.push(n)}function a(e,n){try{if(n===e)throw new TypeError("A promise cannot be resolved with itself.");if(n&&("object"===typeof n||"function"===typeof n)){var t=n.then;if(n instanceof o)return e._state=3,e._value=n,void u(e);if("function"===typeof t)return void c((r=t,i=n,function(){r.apply(i,arguments)}),e)}e._state=1,e._value=n,u(e)}catch(n){s(e,n)}var r,i}function s(e,n){e._state=2,e._value=n,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var n=0,t=e._deferreds.length;n<t;n++)i(e,e._deferreds[n]);e._deferreds=null}function c(e,n){var t=!1;try{e(function(e){t||(t=!0,a(n,e))},function(e){t||(t=!0,s(n,e))})}catch(e){if(t)return;t=!0,s(n,e)}}o.prototype.catch=function(e){return this.then(null,e)},o.prototype.then=function(e,n){var t=new this.constructor(r);return i(this,new function(e,n,t){this.onFulfilled="function"===typeof e?e:null,this.onRejected="function"===typeof n?n:null,this.promise=t}(e,n,t)),t},o.all=function(e){return new o(function(n,t){if(!e||"undefined"===typeof e.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(e);if(0===r.length)return n([]);var o=r.length;function i(e,a){try{if(a&&("object"===typeof a||"function"===typeof a)){var s=a.then;if("function"===typeof s)return void s.call(a,function(n){i(e,n)},t)}r[e]=a,0===--o&&n(r)}catch(e){t(e)}}for(var a=0;a<r.length;a++)i(a,r[a])})},o.resolve=function(e){return e&&"object"===typeof e&&e.constructor===o?e:new o(function(n){n(e)})},o.reject=function(e){return new o(function(n,t){t(e)})},o.race=function(e){return new o(function(n,t){for(var r=0,o=e.length;r<o;r++)e[r].then(n,t)})},o._immediateFn="function"===typeof setImmediate&&function(e){setImmediate(e)}||function(e){t(e,0)},o._unhandledRejectionFn=function(e){"undefined"!==typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},o._setImmediateFn=function(e){o._immediateFn=e},o._setUnhandledRejectionFn=function(e){o._unhandledRejectionFn=e},"undefined"!==typeof e&&e.exports?e.exports=o:n.Promise||(n.Promise=o)}(this)},function(e,n,t){"use strict";var r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var n={},t=0;t<10;t++)n["_"+String.fromCharCode(t)]=t;if("0123456789"!==Object.getOwnPropertyNames(n).map(function(e){return n[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,n){for(var t,a,s=function(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),u=1;u<arguments.length;u++){for(var c in t=Object(arguments[u]))o.call(t,c)&&(s[c]=t[c]);if(r){a=r(t);for(var f=0;f<a.length;f++)i.call(t,a[f])&&(s[a[f]]=t[a[f]])}}return s}},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){}return e.generate=function(){var n=e._getRandomInt,t=e._hexAligner;return t(n(32),8)+"-"+t(n(16),4)+"-"+t(16384|n(12),4)+"-"+t(32768|n(14),4)+"-"+t(n(48),12)},e._getRandomInt=function(e){return e<0?NaN:e<=30?0|Math.random()*(1<<e):e<=53?(0|Math.random()*(1<<30))+(0|Math.random()*(1<<e-30))*(1<<30):NaN},e._getIntAligner=function(e){return function(n,t){for(var r=n.toString(e),o=t-r.length,i="0";o>0;o>>>=1,i+=i)1&o&&(r=i+r);return r}},e._hexAligner=e._getIntAligner(16),e.prototype.toString=function(){return this.hexString},e}(),o={isPromise:function(e){return e&&"function"===typeof e.then},isArray:function(e){return"[object Array]"==Object.prototype.toString.call(e)},isObject:function(e){return"[object Object]"!==Object.prototype.toString.call(e)},id2Arr:function(e){if([].push(e),"[object Array]"==Object.prototype.toString.call(e))return e},serializeFunction:function(e){return!(!e||"function"!==typeof e)&&encodeURI(e.toString())},deSerializeFunction:function(e){return!(!e||"string"!==typeof e)&&decodeURI(e)},serializeError:function(e){var n=void 0,t={},r=["name","message","stack","custom"];if(e instanceof Error){for(n=r.length-1;n>=0;n--)t[r[n]]=e[r[n]];return t}return t},deSerializeError:function(e){var n=void 0,t=new Error("");if(!e)return t;var r=Object.keys(e);for(n=0;n<r.length;n++)t[r[n]]=e[r[n]];return t},stringifyJson:function(e,n){try{e=JSON.stringify(e)}catch(e){console.warn(n)}return e},parseJson:function(e,n){var t=void 0;try{t=JSON.parse(e)}catch(e){console.warn(n)}return t}},i=t(0),a=t.n(i),s={config:{maxWorkers:window.navigator&&window.navigator.hardwareConcurrency||3,minWorkers:1},queue:[],allTasks:{},excuTask:[],changeMaxWorkers:function(e){s.config.maxWorkers=e},addTask:function(e){if(e){var n=e.id;s.allTasks[n]=e,s.queue.push(n),setTimeout(function(){s.updateQueue()},0)}},removeTask:function(e){if(e&&s.allTasks[e]){var n=s.queue.indexOf(e);n>-1&&s.queue.splice(n,1),s.allTasks[e].removeListeners(),s.allTasks[e]=null,delete s.allTasks[e]}},getTask:function(e){var n={},t=e?o.id2Arr(e):Object.keys(s.allTasks);return"string"==typeof e||s.allTasks[e]?s.allTasks[e]:(t&&t.forEach(function(e){s.allTasks[e]&&(n[e]=s.allTasks[e])}),n)},getIdleWorker:function(e){var n={},t=e?o.id2Arr(e):Object.keys(s.allTasks);return"string"==typeof e||s.allTasks[e]?s.allTasks[e]:(t&&t.forEach(function(e){s.allTasks[e]&&!s.allTasks[e].busy&&(n[e]=s.allTasks[e])}),n)},getNextTask:function(e){if(s.queue.length)return e=e||s.queue.shift(),!(!s.allTasks[e]||s.allTasks[e].busy||!s.allTasks[e].excuMethods)?e:s.getNextTask()},updateQueue:function(){if(!(s.excuTask>=s.config.maxWorkers))for(;s.excuTask.length<s.config.maxWorkers;){var e=s.getNextTask();if(!e||s.allTasks[e].busy)break;var n=s.allTasks[e].excuMethods._fn,t=s.allTasks[e].excuMethods._args;s.excuTask.push(e),s.allTasks[e].excu(n,t)}},completeTask:function(e){if(e){var n=s.excuTask.indexOf(e);s.excuTask.splice(n,1),s.updateQueue()}}},u=s,c=t(6),f=t.n(c),l=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();var h=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.init(n)}return l(e,[{key:"init",value:function(e){this.id=e.id?e.id:r.generate(),this.worker=new f.a,this.busy=!1,this.reslover=a.a.defer(),this.excuMethods=e.fn?{_fn:e.fn,_args:e.args}:null,this.addListeners(),u.addTask(this)}},{key:"excu",value:function(e,n){if(this.busy)throw new Error("id:"+this.id+" worker is busy");if(e&&"function"===typeof e){var t=o.serializeFunction(e),r=o.stringifyJson(n);this.busy=!0,this.worker.postMessage({fn:t,args:r})}return this.reslover.promise}},{key:"onMessage",value:function(e){var n;n=o.parseJson(e.data),this.busy=!1,u.completeTask(this.id),this.reslover.resolve(n)}},{key:"onError",value:function(e){var n=o.parseJson(e.data);this.busy=!1,this.reslover.promise.catch(n)}},{key:"addListeners",value:function(e){this.worker.addEventListener("message",this.onMessage.bind(this)),this.worker.addEventListener("error",this.onError.bind(this))}},{key:"removeListeners",value:function(){this.worker.removeEventListener("message",this.onMessage.bind(this)),this.worker.removeEventListener("error",this.onError.bind(this))}}]),e}(),d=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();var p=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.raceReslove=a.a.defer(),this.raceFlag=!0,n.maxWorkers&&u.changeMaxWorkers(n.maxWorkers)}return d(e,[{key:"add",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new h(e).reslover.promise}},{key:"race",value:function(e){var n=this,t=[];return e.forEach(function(e,r){var o=n.add();t.push(o.id),o.excu(e.fn,e.args).then(function(e){n.raceFlag&&(n.raceFlag=!1,n.removeWorker(t),n.raceFlag=!0,n.raceReslove.resolve(e),n.raceReslove=a.a.defer())})}),this.raceReslove.promise}},{key:"getWorker",value:function(e){return u.getTask(e)}},{key:"getIdleWorker",value:function(e){return u.getIdleWorker(e)}},{key:"removeWorker",value:function(e){return u.removeWorker(e)}}]),e}();n.default=p},function(e,n,t){e.exports=function(){return new Worker(t.p+"65046e57f7fd18a0cb0b.worker.js")}}]);